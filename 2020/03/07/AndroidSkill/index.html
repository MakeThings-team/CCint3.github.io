<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ccint3.com","root":"/","images":"/images","scheme":"Pisces","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="APK安装失败[INSTALL_FAILED_VERIFICATION_FAILURE]12adb shell su -c settings put global package_verifier_enable 0adb shell su -c settings put global verifier_verify_adb_installs 0    不插拔USB恢复offline状态的设备12$">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Skill：小技巧">
<meta property="og:url" content="https://ccint3.com/2020/03/07/AndroidSkill/index.html">
<meta property="og:site_name" content="MakeThings Team&#39;Blog">
<meta property="og:description" content="APK安装失败[INSTALL_FAILED_VERIFICATION_FAILURE]12adb shell su -c settings put global package_verifier_enable 0adb shell su -c settings put global verifier_verify_adb_installs 0    不插拔USB恢复offline状态的设备12$">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-03-07T05:42:47.000Z">
<meta property="article:modified_time" content="2021-08-11T16:17:23.959Z">
<meta property="article:author" content="MakeThings Team">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ccint3.com/2020/03/07/AndroidSkill/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ccint3.com/2020/03/07/AndroidSkill/","path":"2020/03/07/AndroidSkill/","title":"Android Skill：小技巧"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Android Skill：小技巧 | MakeThings Team'Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">MakeThings Team'Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#APK%E5%AE%89%E8%A3%85%E5%A4%B1%E8%B4%A5-INSTALL-FAILED-VERIFICATION-FAILURE"><span class="nav-number">1.</span> <span class="nav-text">APK安装失败[INSTALL_FAILED_VERIFICATION_FAILURE]</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E6%8F%92%E6%8B%94USB%E6%81%A2%E5%A4%8Doffline%E7%8A%B6%E6%80%81%E7%9A%84%E8%AE%BE%E5%A4%87"><span class="nav-number">2.</span> <span class="nav-text">不插拔USB恢复offline状态的设备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#adb%E6%9F%A5%E7%9C%8Bapk%E4%BF%A1%E6%81%AF"><span class="nav-number">3.</span> <span class="nav-text">adb查看apk信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#armeabi-v7a%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%A1%A8"><span class="nav-number">4.</span> <span class="nav-text">armeabi-v7a系统调用表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-Studio%E4%B8%AD%E6%8C%87%E5%AE%9AABI"><span class="nav-number">5.</span> <span class="nav-text">Android Studio中指定ABI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E6%95%B4%E5%B1%8F%E5%B9%95%E4%BA%AE%E5%BA%A6"><span class="nav-number">6.</span> <span class="nav-text">调整屏幕亮度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%AA%E5%9B%BE"><span class="nav-number">7.</span> <span class="nav-text">截图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Application%E5%92%8CContext"><span class="nav-number">8.</span> <span class="nav-text">获取Application和Context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#adb-logcat%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%8C%87%E5%AE%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%97%A5%E5%BF%97%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">9.</span> <span class="nav-text">adb logcat中搜索指定进程的日志正则表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%93%E5%BC%80Url-Scheme%E5%8D%8F%E8%AE%AE%E9%93%BE%E6%8E%A5"><span class="nav-number">10.</span> <span class="nav-text">打开Url Scheme协议链接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E7%94%A8%E6%88%B7%E8%AF%81%E4%B9%A6%E4%BF%AE%E6%94%B9%E4%B8%BA%E7%B3%BB%E7%BB%9F%E8%AF%81%E4%B9%A6"><span class="nav-number">11.</span> <span class="nav-text">将用户证书修改为系统证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%83%85%E5%86%B5"><span class="nav-number">12.</span> <span class="nav-text">查找端口占用情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E9%A1%B6%E7%BA%A7Activity"><span class="nav-number">13.</span> <span class="nav-text">查找顶级Activity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9adbd%E7%9A%84%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3"><span class="nav-number">14.</span> <span class="nav-text">更改adbd的监听端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E7%94%A8-%E5%85%B3%E9%97%AD%E5%BC%80%E5%8F%91%E8%80%85%E9%80%89%E9%A1%B9-USB-debugging"><span class="nav-number">15.</span> <span class="nav-text">启用&#x2F;关闭开发者选项 - USB debugging</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E5%90%AF%E5%8A%A8APK"><span class="nav-number">16.</span> <span class="nav-text">调试启动APK</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TWRP%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%8C%82%E8%BD%BD%E6%8C%87%E5%AE%9A%E5%88%86%E5%8C%BA"><span class="nav-number">17.</span> <span class="nav-text">TWRP模式下挂载指定分区</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ubuntu-%E4%B8%8A%E4%BD%BF%E7%94%A8-Android-SDK"><span class="nav-number">18.</span> <span class="nav-text">Ubuntu 上使用 Android-SDK</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#logcat"><span class="nav-number">19.</span> <span class="nav-text">logcat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hide-all-methods-with-CMAKE"><span class="nav-number">20.</span> <span class="nav-text">Hide all methods with CMAKE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fucking-knack-of-use-ollvm-edition-clang-to-compile-so-on-Android-Studio"><span class="nav-number">21.</span> <span class="nav-text">Fucking knack of use ollvm edition clang to compile so on Android Studio</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">MakeThings Team</p>
  <div class="site-description" itemprop="description">皇上吃大饼，两面都蘸酱。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ccint3.com/2020/03/07/AndroidSkill/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="MakeThings Team">
      <meta itemprop="description" content="皇上吃大饼，两面都蘸酱。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MakeThings Team'Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android Skill：小技巧
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-07 13:42:47" itemprop="dateCreated datePublished" datetime="2020-03-07T13:42:47+08:00">2020-03-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-12 00:17:23" itemprop="dateModified" datetime="2021-08-12T00:17:23+08:00">2021-08-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/Skill/" itemprop="url" rel="index"><span itemprop="name">Skill</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="APK安装失败-INSTALL-FAILED-VERIFICATION-FAILURE"><a href="#APK安装失败-INSTALL-FAILED-VERIFICATION-FAILURE" class="headerlink" title="APK安装失败[INSTALL_FAILED_VERIFICATION_FAILURE]"></a>APK安装失败[INSTALL_FAILED_VERIFICATION_FAILURE]</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell su -c settings put global package_verifier_enable 0</span><br><span class="line">adb shell su -c settings put global verifier_verify_adb_installs 0</span><br></pre></td></tr></table></figure>



<h2 id="不插拔USB恢复offline状态的设备"><a href="#不插拔USB恢复offline状态的设备" class="headerlink" title="不插拔USB恢复offline状态的设备"></a>不插拔USB恢复offline状态的设备</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb devices</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> adb -s serial reconnect</span></span><br></pre></td></tr></table></figure>



<h2 id="adb查看apk信息"><a href="#adb查看apk信息" class="headerlink" title="adb查看apk信息"></a>adb查看apk信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell pm list packages | grep aweme</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> adb shell dumpsys package com.ss.android.ugc.aweme</span></span><br></pre></td></tr></table></figure>



<h2 id="armeabi-v7a系统调用表"><a href="#armeabi-v7a系统调用表" class="headerlink" title="armeabi-v7a系统调用表"></a>armeabi-v7a系统调用表</h2><p><a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/external/kernel-headers/+/refs/tags/android-6.0.1_r66/original/uapi/asm-arm/asm/unistd.h">https://android.googlesource.com/platform/external/kernel-headers/+/refs/tags/android-6.0.1_r66/original/uapi/asm-arm/asm/unistd.h</a></p>
<h2 id="Android-Studio中指定ABI"><a href="#Android-Studio中指定ABI" class="headerlink" title="Android Studio中指定ABI"></a>Android Studio中指定ABI</h2><p>编辑<code>app -&gt; build.gradle</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    ndk &#123;</span><br><span class="line">    	abiFilters &#x27;armeabi-v7a&#x27;    //只生成armv7的so</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相关ABI连接：</p>
<p><a target="_blank" rel="noopener" href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.NdkOptions.html">https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.NdkOptions.html</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/abis.html#sa">https://developer.android.com/ndk/guides/abis.html#sa</a></p>
<h2 id="调整屏幕亮度"><a href="#调整屏幕亮度" class="headerlink" title="调整屏幕亮度"></a>调整屏幕亮度</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell su</span></span><br><span class="line">// 屏幕最亮</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> 255 &gt; /sys/class/leds/lcd-backlight/brightness</span></span><br><span class="line"></span><br><span class="line">// 屏幕全黑，没有一点亮度；不影响screencap命令</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> 0 &gt; /sys/class/leds/lcd-backlight/brightness</span></span><br></pre></td></tr></table></figure>



<h2 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell screencap -p /sdcard/01.png &amp; adb pull /sdcard/01.png</span></span><br></pre></td></tr></table></figure>




<h2 id="获取Application和Context"><a href="#获取Application和Context" class="headerlink" title="获取Application和Context"></a>获取Application和Context</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.app.ActivityThread.currentApplication().getApplicationContext()</span><br></pre></td></tr></table></figure>



<h2 id="adb-logcat中搜索指定进程的日志正则表达式"><a href="#adb-logcat中搜索指定进程的日志正则表达式" class="headerlink" title="adb logcat中搜索指定进程的日志正则表达式"></a>adb logcat中搜索指定进程的日志正则表达式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7679\s+\d+\s+\w</span><br></pre></td></tr></table></figure>

<p>android logcat原理：<a target="_blank" rel="noopener" href="http://gityuan.com/2018/01/27/android-log/">http://gityuan.com/2018/01/27/android-log/</a></p>
<h2 id="打开Url-Scheme协议链接"><a href="#打开Url-Scheme协议链接" class="headerlink" title="打开Url Scheme协议链接"></a>打开Url Scheme协议链接</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell am start -a android.intent.action.VIEW -d <span class="string">&quot;snssdk1128://user/profile/3733569708763603&quot;</span></span></span><br></pre></td></tr></table></figure>



<h2 id="将用户证书修改为系统证书"><a href="#将用户证书修改为系统证书" class="headerlink" title="将用户证书修改为系统证书"></a>将用户证书修改为系统证书</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> su</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mount -o remount,rw /system</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -al /data/misc/user/0/cacerts-added/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mv /data/misc/user/0/cacerts-added/* /etc/security/cacerts/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod 644 /etc/security/cacerts/*</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chown root:root /etc/security/cacerts/*</span></span><br></pre></td></tr></table></figure>



<h2 id="查找端口占用情况"><a href="#查找端口占用情况" class="headerlink" title="查找端口占用情况"></a>查找端口占用情况</h2><ul>
<li>通过端口号查找占用该端口的<code>uid</code></li>
</ul>
<p>例如需要查找<code>8081</code>端口，对应的16进制为：<code>0x1f91</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/net/tcp6 | grep -i 1f91</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/net/tcp | grep -i 1f91</span></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">53: 00000000000000000000000000000000:1F91 00000000000000000000000000000000:0000 0A 00000000:00000000 00:00000000 00000000 10080        0 300399 1 0000000000000000 99 0 0 10 -1</span><br></pre></td></tr></table></figure>

<ul>
<li>通过<code>uid</code>查找该<code>uid</code>对应的进程号</li>
</ul>
<p>其中<code>10080</code>是<code>uid</code>； <code>UID(10080) - 10000 = 80 = u0_a80</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell su -c ps | grep u0_a80</span></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p>结果有多个进程都属于<code>u0_a80</code>用户的，那么<code>8081</code>端口就在其中一个进程中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">u0_a80    9732  530   1828844 114996 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme:push</span><br><span class="line">u0_a80    9907  530   2520916 507228 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme</span><br><span class="line">u0_a80    10029 530   1831376 118660 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme:pushservice</span><br><span class="line">u0_a80    10956 530   1799376 102028 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme:downloader</span><br><span class="line">u0_a80    10968 530   1989384 173844 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme:miniapp0</span><br></pre></td></tr></table></figure>

<ul>
<li>根据进程id确定uid</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell su -c cat /proc/9907/cgroup</span></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3:cpuset:/foreground</span><br><span class="line">2:cpu:/</span><br><span class="line">1:cpuacct:/uid_10080/pid_9907</span><br></pre></td></tr></table></figure>



<h2 id="查找顶级Activity"><a href="#查找顶级Activity" class="headerlink" title="查找顶级Activity"></a>查找顶级Activity</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell dumpsys activity activities &gt; activity_activities.log</span></span><br></pre></td></tr></table></figure>

<p>输出格式如下：其中每个<code>Hist</code>代表一个Activity</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ACTIVITY MANAGER ACTIVITIES (dumpsys activity activities)</span><br><span class="line"></span><br><span class="line">Display #<span class="number">0</span> (activities from top to bottom):</span><br><span class="line"></span><br><span class="line">  Stack #<span class="number">4</span>:</span><br><span class="line"></span><br><span class="line">    Task id #<span class="number">144</span></span><br><span class="line"></span><br><span class="line">    * TaskRecord&#123;e98d78a #<span class="number">144</span> A=com<span class="variable">.tencent</span><span class="variable">.karaoke</span> U=<span class="number">0</span> sz=<span class="number">4</span>&#125;</span><br><span class="line">    ...</span><br><span class="line">      * Hist #<span class="number">3</span>: ActivityRecord&#123;<span class="number">6</span>da6fab u0 com<span class="variable">.tencent</span><span class="variable">.karaoke</span>/<span class="variable">.module</span><span class="variable">.detail</span><span class="variable">.ui</span><span class="variable">.GiftBillboardActivity</span> t144&#125;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      * Hist #<span class="number">2</span>: ActivityRecord&#123;cea57ec u0 com<span class="variable">.tencent</span><span class="variable">.karaoke</span>/<span class="variable">.module</span><span class="variable">.live</span><span class="variable">.ui</span><span class="variable">.LiveActivity</span> t144&#125;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      * Hist #<span class="number">1</span>: ActivityRecord&#123;<span class="number">840</span>f95 u0 com<span class="variable">.tencent</span><span class="variable">.karaoke</span>/<span class="variable">.module</span><span class="variable">.webview</span><span class="variable">.ui</span><span class="variable">.WebViewContainerActivity</span> t144&#125;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      * Hist #<span class="number">0</span>: ActivityRecord&#123;ea80b18 u0 com<span class="variable">.tencent</span><span class="variable">.karaoke</span>/<span class="variable">.module</span><span class="variable">.main</span><span class="variable">.ui</span><span class="variable">.MainTabActivity</span> t144&#125;</span><br><span class="line">      ...</span><br></pre></td></tr></table></figure>



<h2 id="更改adbd的监听端口"><a href="#更改adbd的监听端口" class="headerlink" title="更改adbd的监听端口"></a>更改adbd的监听端口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell su</span><br><span class="line"><span class="comment"># setprop service.adb.tcp.port 5555</span></span><br><span class="line"><span class="comment"># stop adbd</span></span><br><span class="line"><span class="comment"># start adbd</span></span><br></pre></td></tr></table></figure>



<h2 id="启用-关闭开发者选项-USB-debugging"><a href="#启用-关闭开发者选项-USB-debugging" class="headerlink" title="启用/关闭开发者选项 - USB debugging"></a>启用/关闭开发者选项 - USB debugging</h2><p>启用：<code>setprop persist.sys.usb.config mtp,adb</code></p>
<p>关闭：<code>setprop persist.sys.usb.config mtp</code><br>相关代码：</p>
<p><code>https://developer.android.com/reference/android/provider/Settings.Global.html#ADB_ENABLED</code></p>
<p><code>https://android.googlesource.com/platform/frameworks/base/+/android-4.4_r1.2/services/java/com/android/server/usb/UsbDeviceManager.java</code></p>
<h2 id="调试启动APK"><a href="#调试启动APK" class="headerlink" title="调试启动APK"></a>调试启动APK</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">:: Example:</span><br><span class="line">::   run_dbg.bat org.github.testsignal .MainActivity</span><br><span class="line">@<span class="built_in">ECHO</span> OFF</span><br><span class="line"><span class="keyword">CALL</span> :DeQuote %<span class="number">1</span></span><br><span class="line"><span class="built_in">SET</span> PACKAGE_NAME=<span class="variable">%return%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> :DeQuote %<span class="number">2</span></span><br><span class="line"><span class="built_in">SET</span> ACTIVITY_NAME=<span class="variable">%return%</span></span><br><span class="line"></span><br><span class="line">adb shell am <span class="built_in">start</span> -D <span class="variable">%PACKAGE_NAME%</span>/<span class="variable">%ACTIVITY_NAME%</span></span><br><span class="line">adb shell ps | <span class="built_in">FINDSTR</span> <span class="variable">%PACKAGE_NAME%</span></span><br><span class="line"><span class="built_in">ECHO</span> please input process id:</span><br><span class="line"><span class="built_in">SET</span> /P PID=</span><br><span class="line">adb forward tcp:<span class="number">12346</span> jdwp:<span class="variable">%PID%</span></span><br><span class="line">jdb -connect com.sun.jdi.SocketAttach:port=<span class="number">12346</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PAUSE</span></span><br><span class="line"><span class="keyword">GOTO</span> :EOF</span><br><span class="line"></span><br><span class="line">:DeQuote</span><br><span class="line">  <span class="built_in">SET</span> return=%~<span class="number">1</span></span><br><span class="line">  <span class="keyword">GOTO</span> :EOF</span><br></pre></td></tr></table></figure>



<h2 id="TWRP模式下挂载指定分区"><a href="#TWRP模式下挂载指定分区" class="headerlink" title="TWRP模式下挂载指定分区"></a>TWRP模式下挂载指定分区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line"><span class="comment"># make /test</span></span><br><span class="line"><span class="comment"># ls -la /dev/block/platform/soc.0/f9824900.sdhci/by-name/boot</span></span><br><span class="line"><span class="comment"># mount /dev/block/mmcblk0p43 /test</span></span><br></pre></td></tr></table></figure>



<h2 id="Ubuntu-上使用-Android-SDK"><a href="#Ubuntu-上使用-Android-SDK" class="headerlink" title="Ubuntu 上使用 Android-SDK"></a>Ubuntu 上使用 Android-SDK</h2><ul>
<li><p>安装<code>platforms</code>时需要注意引号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@github:/opt/android_sdk<span class="comment"># ./tools/bin/sdkmanager --install &quot;platforms;android-23&quot;</span></span><br><span class="line">[=======================================] 100% Unzipping... android-6.0/source.p</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="logcat"><a href="#logcat" class="headerlink" title="logcat"></a>logcat</h2><p>android的Log.d系列日志是写在/dev/log_xxx文件中的；而/dev是挂载在tmpfs文件系统上，所以重启之后日志就消失了。参考：<code>system/core/liblog/logd_write.c</code>和<code>system/core/liblog/logd_write_kern.c</code></p>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># adb shell su -c mount | grep /dev</span></span><br><span class="line">tmpfs /dev tmpfs rw,seclabel,nosuid,relatime,size=1424720k,nr_inodes=356180,mode=755 0 0</span><br></pre></td></tr></table></figure>



<h2 id="Hide-all-methods-with-CMAKE"><a href="#Hide-all-methods-with-CMAKE" class="headerlink" title="Hide all methods with CMAKE"></a>Hide all methods with CMAKE</h2><p>在 CMAKE 中设置隐藏所有方法(不显示他们的符号)；</p>
<p>Hide all methods without add “__attribute__(visibility(“default”))” for everyone of them:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(YOUR_TARGET_NAME PROPERTIES CXX_VISIBILITY_PRESET hidden)</span><br><span class="line"><span class="keyword">set_target_properties</span>(YOUR_TARGET_NAME PROPERTIES C_VISIBILITY_PRESET hidden)</span><br></pre></td></tr></table></figure>



<h2 id="Fucking-knack-of-use-ollvm-edition-clang-to-compile-so-on-Android-Studio"><a href="#Fucking-knack-of-use-ollvm-edition-clang-to-compile-so-on-Android-Studio" class="headerlink" title="Fucking knack of use ollvm edition clang to compile so on Android Studio"></a>Fucking knack of use ollvm edition clang to compile so on Android Studio</h2><p>在 Android Studio 中使用 ollvm 版本的 clang 编译 so；</p>
<p>​    As you know, if you just overwrite the compiler executable file with ollvm edition, then you will get “‘xxx.h’ file not found” error, actually I am not understand this error explicitly, because the file exactly is there, and it will perform like you want when execute that compile command on shell, so here is my approach to avoid that:</p>
<p>​    Open “YOUT_PROJECT_PATH\app.externalNativeBuild\cmake\debug\TARGET_ABI\rules.ninja”, find the line of “rule C_COMPILER__TARGET”(TARGET mean the target name you specified by “add_library” on “CMakeLists.txt”), and you will find the path of clang executable file under it, modify it with your ollvm edition clang, then build your project as normal, you will get the ollvm compiled file.</p>
<p>​    如果简单的使用 ollvm 版本的 clang.exe 等可执行文件替换掉原版 ndk toolchain 中的 exe，那么将会报一些头文件查找不到的错误，网上说的原因似乎是不同版本的 clang 将会使用的头文件有差异，然而如果在控制台中直接使用 ollvm 版本 clang 去手动执行编译命令，是可以正常编译成功得到 .o 文件的，以下是我避免该坑的方法：</p>
<p>​    打开 “YOUT_PROJECT_PATH\app.externalNativeBuild\cmake\debug\TARGET_ABI\rules.ninja”，找到 “rule C_COMPILER__TARGET” 这一行(TARGET 指你在 CMakeLists.txt 中使用 add_library 指定的库名)，然后你会在下面几行找到编译使用的 clang 路径，把它替换为你 ollvm 版本 clang 的路径，然后正常编译即可得到你想要的 so。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/03/06/Gnirehtet/" rel="prev" title="Gnirehtet：让Android可以通过USB方式上网">
                  <i class="fa fa-chevron-left"></i> Gnirehtet：让Android可以通过USB方式上网
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/03/07/adb%20forward-Rinetd/" rel="next" title="adb forward + Rinetd：如何让Android设备变成一台服务器">
                  adb forward + Rinetd：如何让Android设备变成一台服务器 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MakeThings Team</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"MakeThings-team/utterance_repo","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
