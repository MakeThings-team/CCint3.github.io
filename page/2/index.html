<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ccint3.com","root":"/","images":"/images","scheme":"Pisces","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="皇上吃大饼，两面都蘸酱。">
<meta property="og:type" content="website">
<meta property="og:title" content="MakeThings Team&#39;Blog">
<meta property="og:url" content="https://ccint3.com/page/2/index.html">
<meta property="og:site_name" content="MakeThings Team&#39;Blog">
<meta property="og:description" content="皇上吃大饼，两面都蘸酱。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="MakeThings Team">
<meta property="article:tag" content="asm, C&#x2F;C++, C++, android, windows">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ccint3.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MakeThings Team'Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">MakeThings Team'Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">MakeThings Team</p>
  <div class="site-description" itemprop="description">皇上吃大饼，两面都蘸酱。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ccint3.com/2020/03/07/AndroidSkill/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="MakeThings Team">
      <meta itemprop="description" content="皇上吃大饼，两面都蘸酱。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MakeThings Team'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/07/AndroidSkill/" class="post-title-link" itemprop="url">Android Skill：小技巧</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-07 13:42:47" itemprop="dateCreated datePublished" datetime="2020-03-07T13:42:47+08:00">2020-03-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-12 17:50:53" itemprop="dateModified" datetime="2021-08-12T17:50:53+08:00">2021-08-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/Skill/" itemprop="url" rel="index"><span itemprop="name">Skill</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="APK安装失败-INSTALL-FAILED-VERIFICATION-FAILURE"><a href="#APK安装失败-INSTALL-FAILED-VERIFICATION-FAILURE" class="headerlink" title="APK安装失败[INSTALL_FAILED_VERIFICATION_FAILURE]"></a>APK安装失败[INSTALL_FAILED_VERIFICATION_FAILURE]</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell su -c settings put global package_verifier_enable 0</span><br><span class="line">adb shell su -c settings put global verifier_verify_adb_installs 0</span><br></pre></td></tr></table></figure>



<h2 id="不插拔USB恢复offline状态的设备"><a href="#不插拔USB恢复offline状态的设备" class="headerlink" title="不插拔USB恢复offline状态的设备"></a>不插拔USB恢复offline状态的设备</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb devices</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> adb -s serial reconnect</span></span><br></pre></td></tr></table></figure>



<h2 id="adb查看apk信息"><a href="#adb查看apk信息" class="headerlink" title="adb查看apk信息"></a>adb查看apk信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell pm list packages | grep aweme</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> adb shell dumpsys package com.ss.android.ugc.aweme</span></span><br></pre></td></tr></table></figure>



<h2 id="armeabi-v7a系统调用表"><a href="#armeabi-v7a系统调用表" class="headerlink" title="armeabi-v7a系统调用表"></a>armeabi-v7a系统调用表</h2><p><a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/external/kernel-headers/+/refs/tags/android-6.0.1_r66/original/uapi/asm-arm/asm/unistd.h">https://android.googlesource.com/platform/external/kernel-headers/+/refs/tags/android-6.0.1_r66/original/uapi/asm-arm/asm/unistd.h</a></p>
<h2 id="Android-Studio中指定ABI"><a href="#Android-Studio中指定ABI" class="headerlink" title="Android Studio中指定ABI"></a>Android Studio中指定ABI</h2><p>编辑<code>app -&gt; build.gradle</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    ndk &#123;</span><br><span class="line">    	abiFilters &#x27;armeabi-v7a&#x27;    //只生成armv7的so</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相关ABI连接：</p>
<p><a target="_blank" rel="noopener" href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.NdkOptions.html">https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.NdkOptions.html</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/abis.html#sa">https://developer.android.com/ndk/guides/abis.html#sa</a></p>
<h2 id="调整屏幕亮度"><a href="#调整屏幕亮度" class="headerlink" title="调整屏幕亮度"></a>调整屏幕亮度</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell su</span></span><br><span class="line">// 屏幕最亮</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> 255 &gt; /sys/class/leds/lcd-backlight/brightness</span></span><br><span class="line"></span><br><span class="line">// 屏幕全黑，没有一点亮度；不影响screencap命令</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> 0 &gt; /sys/class/leds/lcd-backlight/brightness</span></span><br></pre></td></tr></table></figure>



<h2 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell screencap -p /sdcard/01.png &amp; adb pull /sdcard/01.png</span></span><br></pre></td></tr></table></figure>




<h2 id="获取Application和Context"><a href="#获取Application和Context" class="headerlink" title="获取Application和Context"></a>获取Application和Context</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.app.ActivityThread.currentApplication().getApplicationContext()</span><br></pre></td></tr></table></figure>



<h2 id="adb-logcat中搜索指定进程的日志正则表达式"><a href="#adb-logcat中搜索指定进程的日志正则表达式" class="headerlink" title="adb logcat中搜索指定进程的日志正则表达式"></a>adb logcat中搜索指定进程的日志正则表达式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7679\s+\d+\s+\w</span><br></pre></td></tr></table></figure>

<p>android logcat原理：<a target="_blank" rel="noopener" href="http://gityuan.com/2018/01/27/android-log/">http://gityuan.com/2018/01/27/android-log/</a></p>
<h2 id="打开Url-Scheme协议链接"><a href="#打开Url-Scheme协议链接" class="headerlink" title="打开Url Scheme协议链接"></a>打开Url Scheme协议链接</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell am start -a android.intent.action.VIEW -d <span class="string">&quot;snssdk1128://user/profile/3733569708763603&quot;</span></span></span><br></pre></td></tr></table></figure>



<h2 id="将用户证书修改为系统证书"><a href="#将用户证书修改为系统证书" class="headerlink" title="将用户证书修改为系统证书"></a>将用户证书修改为系统证书</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> su</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mount -o remount,rw /system</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -al /data/misc/user/0/cacerts-added/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mv /data/misc/user/0/cacerts-added/* /etc/security/cacerts/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod 644 /etc/security/cacerts/*</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chown root:root /etc/security/cacerts/*</span></span><br></pre></td></tr></table></figure>



<h2 id="查找端口占用情况"><a href="#查找端口占用情况" class="headerlink" title="查找端口占用情况"></a>查找端口占用情况</h2><ul>
<li>通过端口号查找占用该端口的<code>uid</code></li>
</ul>
<p>例如需要查找<code>8081</code>端口，对应的16进制为：<code>0x1f91</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/net/tcp6 | grep -i 1f91</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/net/tcp | grep -i 1f91</span></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">53: 00000000000000000000000000000000:1F91 00000000000000000000000000000000:0000 0A 00000000:00000000 00:00000000 00000000 10080        0 300399 1 0000000000000000 99 0 0 10 -1</span><br></pre></td></tr></table></figure>

<ul>
<li>通过<code>uid</code>查找该<code>uid</code>对应的进程号</li>
</ul>
<p>其中<code>10080</code>是<code>uid</code>； <code>UID(10080) - 10000 = 80 = u0_a80</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell su -c ps | grep u0_a80</span></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p>结果有多个进程都属于<code>u0_a80</code>用户的，那么<code>8081</code>端口就在其中一个进程中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">u0_a80    9732  530   1828844 114996 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme:push</span><br><span class="line">u0_a80    9907  530   2520916 507228 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme</span><br><span class="line">u0_a80    10029 530   1831376 118660 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme:pushservice</span><br><span class="line">u0_a80    10956 530   1799376 102028 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme:downloader</span><br><span class="line">u0_a80    10968 530   1989384 173844 SyS_epoll_ 00f734acb8 S com.ss.android.ugc.aweme:miniapp0</span><br></pre></td></tr></table></figure>

<ul>
<li>根据进程id确定uid</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell su -c cat /proc/9907/cgroup</span></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3:cpuset:/foreground</span><br><span class="line">2:cpu:/</span><br><span class="line">1:cpuacct:/uid_10080/pid_9907</span><br></pre></td></tr></table></figure>



<h2 id="查找顶级Activity"><a href="#查找顶级Activity" class="headerlink" title="查找顶级Activity"></a>查找顶级Activity</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell dumpsys activity activities &gt; activity_activities.log</span></span><br></pre></td></tr></table></figure>

<p>输出格式如下：其中每个<code>Hist</code>代表一个Activity</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ACTIVITY MANAGER ACTIVITIES (dumpsys activity activities)</span><br><span class="line"></span><br><span class="line">Display #<span class="number">0</span> (activities from top to bottom):</span><br><span class="line"></span><br><span class="line">  Stack #<span class="number">4</span>:</span><br><span class="line"></span><br><span class="line">    Task id #<span class="number">144</span></span><br><span class="line"></span><br><span class="line">    * TaskRecord&#123;e98d78a #<span class="number">144</span> A=com<span class="variable">.tencent</span><span class="variable">.karaoke</span> U=<span class="number">0</span> sz=<span class="number">4</span>&#125;</span><br><span class="line">    ...</span><br><span class="line">      * Hist #<span class="number">3</span>: ActivityRecord&#123;<span class="number">6</span>da6fab u0 com<span class="variable">.tencent</span><span class="variable">.karaoke</span>/<span class="variable">.module</span><span class="variable">.detail</span><span class="variable">.ui</span><span class="variable">.GiftBillboardActivity</span> t144&#125;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      * Hist #<span class="number">2</span>: ActivityRecord&#123;cea57ec u0 com<span class="variable">.tencent</span><span class="variable">.karaoke</span>/<span class="variable">.module</span><span class="variable">.live</span><span class="variable">.ui</span><span class="variable">.LiveActivity</span> t144&#125;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      * Hist #<span class="number">1</span>: ActivityRecord&#123;<span class="number">840</span>f95 u0 com<span class="variable">.tencent</span><span class="variable">.karaoke</span>/<span class="variable">.module</span><span class="variable">.webview</span><span class="variable">.ui</span><span class="variable">.WebViewContainerActivity</span> t144&#125;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      * Hist #<span class="number">0</span>: ActivityRecord&#123;ea80b18 u0 com<span class="variable">.tencent</span><span class="variable">.karaoke</span>/<span class="variable">.module</span><span class="variable">.main</span><span class="variable">.ui</span><span class="variable">.MainTabActivity</span> t144&#125;</span><br><span class="line">      ...</span><br></pre></td></tr></table></figure>



<h2 id="更改adbd的监听端口"><a href="#更改adbd的监听端口" class="headerlink" title="更改adbd的监听端口"></a>更改adbd的监听端口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell su</span><br><span class="line"><span class="comment"># setprop service.adb.tcp.port 5555</span></span><br><span class="line"><span class="comment"># stop adbd</span></span><br><span class="line"><span class="comment"># start adbd</span></span><br></pre></td></tr></table></figure>



<h2 id="启用-关闭开发者选项-USB-debugging"><a href="#启用-关闭开发者选项-USB-debugging" class="headerlink" title="启用/关闭开发者选项 - USB debugging"></a>启用/关闭开发者选项 - USB debugging</h2><p>启用：<code>setprop persist.sys.usb.config mtp,adb</code></p>
<p>关闭：<code>setprop persist.sys.usb.config mtp</code><br>相关代码：</p>
<p><code>https://developer.android.com/reference/android/provider/Settings.Global.html#ADB_ENABLED</code></p>
<p><code>https://android.googlesource.com/platform/frameworks/base/+/android-4.4_r1.2/services/java/com/android/server/usb/UsbDeviceManager.java</code></p>
<h2 id="调试启动APK"><a href="#调试启动APK" class="headerlink" title="调试启动APK"></a>调试启动APK</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">:: Example:</span><br><span class="line">::   run_dbg.bat org.github.testsignal .MainActivity</span><br><span class="line">@<span class="built_in">ECHO</span> OFF</span><br><span class="line"><span class="keyword">CALL</span> :DeQuote %<span class="number">1</span></span><br><span class="line"><span class="built_in">SET</span> PACKAGE_NAME=<span class="variable">%return%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> :DeQuote %<span class="number">2</span></span><br><span class="line"><span class="built_in">SET</span> ACTIVITY_NAME=<span class="variable">%return%</span></span><br><span class="line"></span><br><span class="line">adb shell am <span class="built_in">start</span> -D <span class="variable">%PACKAGE_NAME%</span>/<span class="variable">%ACTIVITY_NAME%</span></span><br><span class="line">adb shell ps | <span class="built_in">FINDSTR</span> <span class="variable">%PACKAGE_NAME%</span></span><br><span class="line"><span class="built_in">ECHO</span> please input process id:</span><br><span class="line"><span class="built_in">SET</span> /P PID=</span><br><span class="line">adb forward tcp:<span class="number">12346</span> jdwp:<span class="variable">%PID%</span></span><br><span class="line">jdb -connect com.sun.jdi.SocketAttach:port=<span class="number">12346</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PAUSE</span></span><br><span class="line"><span class="keyword">GOTO</span> :EOF</span><br><span class="line"></span><br><span class="line">:DeQuote</span><br><span class="line">  <span class="built_in">SET</span> return=%~<span class="number">1</span></span><br><span class="line">  <span class="keyword">GOTO</span> :EOF</span><br></pre></td></tr></table></figure>



<h2 id="TWRP模式下挂载指定分区"><a href="#TWRP模式下挂载指定分区" class="headerlink" title="TWRP模式下挂载指定分区"></a>TWRP模式下挂载指定分区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line"><span class="comment"># make /test</span></span><br><span class="line"><span class="comment"># ls -la /dev/block/platform/soc.0/f9824900.sdhci/by-name/boot</span></span><br><span class="line"><span class="comment"># mount /dev/block/mmcblk0p43 /test</span></span><br></pre></td></tr></table></figure>



<h2 id="Ubuntu-上使用-Android-SDK"><a href="#Ubuntu-上使用-Android-SDK" class="headerlink" title="Ubuntu 上使用 Android-SDK"></a>Ubuntu 上使用 Android-SDK</h2><ul>
<li><p>安装<code>platforms</code>时需要注意引号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@github:/opt/android_sdk<span class="comment"># ./tools/bin/sdkmanager --install &quot;platforms;android-23&quot;</span></span><br><span class="line">[=======================================] 100% Unzipping... android-6.0/source.p</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="logcat"><a href="#logcat" class="headerlink" title="logcat"></a>logcat</h2><p>android的Log.d系列日志是写在/dev/log_xxx文件中的；而/dev是挂载在tmpfs文件系统上，所以重启之后日志就消失了。参考：<code>system/core/liblog/logd_write.c</code>和<code>system/core/liblog/logd_write_kern.c</code></p>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># adb shell su -c mount | grep /dev</span></span><br><span class="line">tmpfs /dev tmpfs rw,seclabel,nosuid,relatime,size=1424720k,nr_inodes=356180,mode=755 0 0</span><br></pre></td></tr></table></figure>



<h2 id="Hide-all-methods-with-CMAKE"><a href="#Hide-all-methods-with-CMAKE" class="headerlink" title="Hide all methods with CMAKE"></a>Hide all methods with CMAKE</h2><p>在 CMAKE 中设置隐藏所有方法(不显示他们的符号)；</p>
<p>Hide all methods without add “__attribute__(visibility(“default”))” for everyone of them:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(YOUR_TARGET_NAME PROPERTIES CXX_VISIBILITY_PRESET hidden)</span><br><span class="line"><span class="keyword">set_target_properties</span>(YOUR_TARGET_NAME PROPERTIES C_VISIBILITY_PRESET hidden)</span><br></pre></td></tr></table></figure>



<h2 id="Fucking-knack-of-use-ollvm-edition-clang-to-compile-so-on-Android-Studio"><a href="#Fucking-knack-of-use-ollvm-edition-clang-to-compile-so-on-Android-Studio" class="headerlink" title="Fucking knack of use ollvm edition clang to compile so on Android Studio"></a>Fucking knack of use ollvm edition clang to compile so on Android Studio</h2><p>在 Android Studio 中使用 ollvm 版本的 clang 编译 so；</p>
<p>​    As you know, if you just overwrite the compiler executable file with ollvm edition, then you will get “‘xxx.h’ file not found” error, actually I am not understand this error explicitly, because the file exactly is there, and it will perform like you want when execute that compile command on shell, so here is my approach to avoid that:</p>
<p>​    Open “YOUT_PROJECT_PATH\app.externalNativeBuild\cmake\debug\TARGET_ABI\rules.ninja”, find the line of “rule C_COMPILER__TARGET”(TARGET mean the target name you specified by “add_library” on “CMakeLists.txt”), and you will find the path of clang executable file under it, modify it with your ollvm edition clang, then build your project as normal, you will get the ollvm compiled file.</p>
<p>​    如果简单的使用 ollvm 版本的 clang.exe 等可执行文件替换掉原版 ndk toolchain 中的 exe，那么将会报一些头文件查找不到的错误，网上说的原因似乎是不同版本的 clang 将会使用的头文件有差异，然而如果在控制台中直接使用 ollvm 版本 clang 去手动执行编译命令，是可以正常编译成功得到 .o 文件的，以下是我避免该坑的方法：</p>
<p>​    打开 “YOUT_PROJECT_PATH\app.externalNativeBuild\cmake\debug\TARGET_ABI\rules.ninja”，找到 “rule C_COMPILER__TARGET” 这一行(TARGET 指你在 CMakeLists.txt 中使用 add_library 指定的库名)，然后你会在下面几行找到编译使用的 clang 路径，把它替换为你 ollvm 版本 clang 的路径，然后正常编译即可得到你想要的 so。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ccint3.com/2020/03/06/Gnirehtet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="MakeThings Team">
      <meta itemprop="description" content="皇上吃大饼，两面都蘸酱。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MakeThings Team'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/06/Gnirehtet/" class="post-title-link" itemprop="url">Gnirehtet：让Android可以通过USB方式上网</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-07 05:37:35" itemprop="dateCreated datePublished" datetime="2020-03-07T05:37:35+08:00">2020-03-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-12 17:50:53" itemprop="dateModified" datetime="2021-08-12T17:50:53+08:00">2021-08-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p><a target="_blank" rel="noopener" href="https://github.com/Genymobile/gnirehtet">Gnirehtet</a>是一个非常优秀的项目。该项目为Android设备提供了通过<a target="_blank" rel="noopener" href="https://developer.android.com/studio/command-line/adb.html">adb</a>方式的反向代理。它允许Android设备通过<code>USB</code>使用所接入计算机的<code>Internet</code>网络，并且计算机和Android设备都不需要任何<code>root</code>权限。它的服务器可以运行在<code>GNU/Linux</code>、<code>Windows</code>和<code>Mac OS</code>上，客户端需要运行在<a target="_blank" rel="noopener" href="https://developer.android.com/about/versions/lollipopAndroid">Android Lollipop API 21</a> 及以上。</p>
<p><code>Gnirehtet</code>的当前版本(<code>v2.4</code>)支持通过<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IPv4">IPv4</a>传输<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">TCP</a>和<a target="_blank" rel="noopener" href="https://fr.wikipedia.org/wiki/User_Datagram_Protocol">UDP</a>协议的数据，但不支持<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IPv6l">IPv6</a>。</p>
<h2 id="它是如何工作的"><a href="#它是如何工作的" class="headerlink" title="它是如何工作的"></a>它是如何工作的</h2><p>客户端(Client)：android设备视为客户端。注册<a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/net/VpnService.html">VPN</a>服务，以拦截整个设备的网络流量。</p>
<p>服务器(Relay Server)：计算机(<code>Windows</code>、<code>GNU/Linux</code>或<code>Mac OS</code>)视为服务器。也称作<code>中继服务器</code>。</p>
<p>客户端仅建立与服务器之间的<code>TCP</code>连接；并通过该<code>TCP</code>连接以<code>字节数组</code>的形式交换原生<code>IPv4数据包</code>；</p>
<p>客户端和服务器之间的<code>TCP</code>连接在开始反向端口重定向后由<code>adb</code>建立，反向端口重定向命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reverse localabstract:gnirehtet tcp:31416</span><br></pre></td></tr></table></figure>



<p>这意味着服务器必须监听<code>31416</code>端口，并且客户端的所有的<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Berkeley_sockets">sockets</a>连接都将由<code>adb</code>重定向到服务器的<code>31416</code>端口上。所以务必确保服务器的<code>31416</code>端口未被其他程序占用，务必确保服务器和客户端之间的<code>USB</code>连接是正常且稳定的。</p>
<p>服务器从连接的客户端上接收<code>IPv4数据包</code>并且根据数据包与对应的目标<code>IP</code>建立<code>sockets</code>连接，然后开始双向中继传输数据。</p>
<p>这就需要服务器在<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/OSI_model">OSI model</a>上以<code>Level 3(客户端一边)</code>和<code>Level 5(外网一边)</code>之间传输数据包；</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Genymobile/gnirehtet/blob/master/DEVELOP.md#overview">获取更多详情请点我</a></p>
<h2 id="为什么选择它"><a href="#为什么选择它" class="headerlink" title="为什么选择它"></a>为什么选择它</h2><p>当Android设备的<code>WIFI</code>不够稳定时，或想获得更高的下载速度，或其他一些原因；</p>
<h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.android.com/about/versions/lollipopAndroid">Android Lollipop API 21</a> 及以上；</p>
</li>
<li><p>Android设备需要启动<a target="_blank" rel="noopener" href="https://developer.android.com/studio/command-line/adb.html#Enabling">adb debugging</a> ；</p>
</li>
<li><p>Java 8的运行时环境，在<code>Debian-based</code>发行版上，需要<code>openjdk-8-jre</code>；</p>
</li>
<li><p><code>adb 1.0.36</code>及以上，因为需要<code>adb reverse</code>支持；</p>
</li>
<li><p>服务器的<code>31416</code>端口未被占用且网络正常；</p>
</li>
</ul>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>根据需要下载对应的版本，建议下载最新版本：<a target="_blank" rel="noopener" href="https://github.com/Genymobile/gnirehtet/releases/latest">Last Release</a></p>
<h3 id="Rust-版本"><a href="#Rust-版本" class="headerlink" title="Rust 版本"></a>Rust 版本</h3><ul>
<li><strong>Linux：</strong>  <code>gnirehtet-rust-linux64-XXX.zip</code></li>
<li><strong>Windows：</strong> <code>gnirehtet-rust-win64-XXX.zip</code></li>
<li><strong>Mac OS：</strong> <code>gnirehtet-rust-macos64-XXX.zip</code></li>
</ul>
<p><code>Linux</code>和<code>Mac OS</code> zip文件解压后包含以下文件：</p>
<ul>
<li><code>gnirehtet.apk</code>：安装在客户端上。</li>
<li><code>gnirehtet</code>：安装在服务器上。</li>
</ul>
<p><code>Windows</code> zip文件解压后包含以下文件：</p>
<ul>
<li><code>gnirehtet.apk：</code>安装在客户端上。</li>
<li><code>gnirehtet.exe：</code>安装在Windows服务器上。</li>
<li><code>gnirehtet-run.cmd：</code>快速启动<code>gnirehtet</code>的批处理文件。</li>
</ul>
<h3 id="Java-版本"><a href="#Java-版本" class="headerlink" title="Java 版本"></a>Java 版本</h3><ul>
<li><strong>全平台：</strong> <code>gnirehtet-java-XXX.zip</code></li>
</ul>
<p>解压后包含以下文件：</p>
<ul>
<li><code>gnirehtet.apk：</code>安装在客户端上。</li>
<li><code>gnirehtet.jar:</code>部署在服务器上</li>
<li><code>gnirehtet：</code>部署在服务器上</li>
<li><code>gnirehtet.cmd：</code>部署在Windows服务器上</li>
<li><code>gnirehtet-run.cmd：</code>快速启动<code>gnirehtet</code>的批处理文件。</li>
</ul>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>在服务器上启动服务，该服务不提供用户界面，以控制台终端的形式呈现：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gnirehtet relay</span><br></pre></td></tr></table></figure>

<p>在<code>Ubuntu</code>上使<code>Gnirehtet</code>不占用命令行终端在后台运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nohup ./gnirehtet relay &amp;</span><br></pre></td></tr></table></figure>



<p>在客户端上安装<strong>APK</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install -r gnirehtet.apk</span><br></pre></td></tr></table></figure>



<p>设置反向端口重定向并启动<strong>APP</strong>，该<strong>APP</strong>不提供用户界面，以<code>Android Service</code>的方式运行在系统后台：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb reverse localabstract:gnirehtet tcp:31416</span><br><span class="line">adb shell am start -a com.genymobile.gnirehtet.START -n com.genymobile.gnirehtet/.GnirehtetActivity</span><br></pre></td></tr></table></figure>



<p>停止客户端：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -a com.genymobile.gnirehtet.STOP -n com.genymobile.gnirehtet/.GnirehtetActivity</span><br></pre></td></tr></table></figure>



<p>停止服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在gnirehtet的命令行终端上按下Ctrl + C组合键</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MakeThings Team</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"MakeThings-team/utterance_repo","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
